<div class="card">
  <h1>{{post.title}}</h1>
  <p class="meta">
    By <strong>{{post.author.username}}</strong> | {{formatDate post.createdAt}}
    {{#unless (eq post.createdAt post.updatedAt)}}
      | Updated: {{formatDate post.updatedAt}}
    {{/unless}}
  </p>
  
  <div class="post-content">{{post.content}}</div>
  
  {{#if isOwner}}
    <div class="actions">
      <a href="/posts/{{post.id}}/edit" class="btn">Edit</a>
      <form method="POST" action="/posts/{{post.id}}/delete" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this post?');">
        <button type="submit" class="btn btn-danger">Delete</button>
      </form>
    </div>
  {{/if}}
</div>

<div class="card">
  <h2>Comments ({{post.comments.length}})</h2>
  
  {{#if user}}
    <form method="POST" action="/comments" style="margin-bottom: 20px;">
      <input type="hidden" name="postId" value="{{post.id}}">
      <div class="form-group">
        <label for="content">Add a comment</label>
        <textarea id="content" name="content" required style="min-height: 80px;"></textarea>
      </div>
      <button type="submit" class="btn">Post Comment</button>
    </form>
  {{else}}
    <p style="margin-bottom: 20px;"><a href="/login">Login</a> to leave a comment.</p>
  {{/if}}
  
  {{#if post.comments.length}}
    {{#each post.comments}}
      <div style="border-bottom: 1px solid #eee; padding: 15px 0;">
        <p class="meta">
          <strong>{{this.author.username}}</strong> | {{formatDate this.createdAt}}
        </p>
        <p>{{this.content}}</p>
        
        {{#if ../user}}
          {{#if (eq ../user.id this.authorId)}}
            <div class="actions" style="margin-top: 10px;">
              <a href="/comments/{{this.id}}/edit" class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;">Edit</a>
              <form method="POST" action="/comments/{{this.id}}/delete" style="display: inline;" onsubmit="return confirm('Delete this comment?');">
                <input type="hidden" name="postId" value="{{../post.id}}">
                <button type="submit" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">Delete</button>
              </form>
            </div>
          {{/if}}
        {{/if}}
      </div>
    {{/each}}
  {{else}}
    <p>No comments yet. Be the first to comment!</p>
  {{/if}}
</div>

<p style="margin-top: 20px;">
  <a href="/posts">&larr; Back to all posts</a>
</p>
